<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spion Spiel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        .section { display: none; }
        .active { display: block; }
        body { background-color: #f8f9fa; }
        #countdownDisplay { font-size: 2rem; font-weight: bold; color: red; text-align: center; }
    </style>
</head>
<body>
<div class="container my-5">

    <!-- Start Section -->
    <div id="startSection" class="section active">
        <h1 class="text-center mb-4">Spion Spiel</h1>
        <div class="row justify-content-center">
            <div class="col-md-6 col-lg-4">
                <div class="card mb-4">
                    <div class="card-body">
                        <h2 class="card-title text-center">Raum erstellen</h2>
                        <div class="mb-3">
                            <input type="text" id="createPlayerName" class="form-control" placeholder="Dein Name">
                        </div>
                        <div class="mb-3">
                            <select id="roomSize" class="form-select">
                                <option value="3">3 Spieler</option>
                                <option value="4">4 Spieler</option>
                                <option value="5">5 Spieler</option>
                                <option value="6">6 Spieler</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <select id="spyCount" class="form-select">
                                <option value="1">1 Spion</option>
                                <option value="2">2 Spione</option>
                                <option value="3">3 Spione</option>
                            </select>
                        </div>
                        <button onclick="createRoom()" class="btn btn-primary w-100">Raum erstellen</button>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-4">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title text-center">Raum beitreten</h2>
                        <div class="mb-3">
                            <input type="text" id="joinPlayerName" class="form-control" placeholder="Dein Name">
                        </div>
                        <div class="mb-3">
                            <input type="text" id="roomIdInput" class="form-control" placeholder="Raum-ID">
                        </div>
                        <button onclick="joinRoom()" class="btn btn-primary w-100">Raum beitreten</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Waiting Section -->
    <div id="waitingSection" class="section">
        <h2 class="text-center mb-4">Warte auf Spieler...</h2>
        <div class="card">
            <div class="card-body">
                <p><strong>Raum-ID:</strong> <span id="roomId"></span></p>
                <p><strong>Spieler:</strong> <span id="players"></span></p>
                <button onclick="leaveRoom()" class="btn btn-secondary w-100">Raum verlassen</button>
            </div>
        </div>
    </div>

    <!-- Word Input Section -->
    <div id="wordInputSection" class="section">
        <h2 class="text-center mb-4">Gib 5 Begriffe ein</h2>
        <div class="card">
            <div class="card-body">
                <input type="text" id="word1" class="form-control mb-2" placeholder="Begriff 1">
                <input type="text" id="word2" class="form-control mb-2" placeholder="Begriff 2">
                <input type="text" id="word3" class="form-control mb-2" placeholder="Begriff 3">
                <input type="text" id="word4" class="form-control mb-2" placeholder="Begriff 4">
                <input type="text" id="word5" class="form-control mb-2" placeholder="Begriff 5">
                <button onclick="submitWords()" class="btn btn-primary w-100 mb-3">Begriffe senden</button>
                <hr>
                <p class="text-center"><strong>Eingereichte Spieler:</strong></p>
                <p id="committedPlayersList" class="text-center text-muted">Noch keine Spieler haben Begriffe eingereicht.</p>
                <p id="countdownDisplay"></p>
            </div>
        </div>
    </div>

    <!-- Game Section -->
    <div id="gameSection" class="section">
        <h1 class="text-center mb-4">Spion Spiel</h1>
        <div class="card">
            <div class="card-body">
                <p><strong>Deine Rolle:</strong> <span id="role"></span></p>
                <p id="word"></p>
                <p><strong>Spieler:</strong> <span id="gamePlayers"></span></p>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const socket = io();
    let currentRoomId = null;

    function showSection(sectionId) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(sectionId).classList.add('active');
    }

    function createRoom() {
        const playerName = document.getElementById('createPlayerName').value.trim();
        const roomSize = parseInt(document.getElementById('roomSize').value);
        const spyCount = parseInt(document.getElementById('spyCount').value);
        if (!playerName) return alert('Bitte gib einen Namen ein.');
        if (spyCount >= roomSize) return alert('Die Anzahl der Spione muss kleiner als die Raumgröße sein.');
        socket.emit('createRoom', { playerName, roomSize, spyCount });
    }

    function joinRoom() {
        const playerName = document.getElementById('joinPlayerName').value.trim();
        const roomId = document.getElementById('roomIdInput').value.trim();
        if (!playerName || !roomId) return alert('Bitte gib Namen und Raum-ID ein.');
        socket.emit('joinRoom', { playerName, roomId });
    }

    function leaveRoom() {
        socket.emit('leaveRoom', { roomId: currentRoomId });
        currentRoomId = null;
        showSection('startSection');
    }

    function submitWords() {
        const words = [
            document.getElementById('word1').value.trim(),
            document.getElementById('word2').value.trim(),
            document.getElementById('word3').value.trim(),
            document.getElementById('word4').value.trim(),
            document.getElementById('word5').value.trim()
        ];
        if (words.some(w => !w)) return alert('Bitte gib alle 5 Begriffe ein.');
        const playerName = document.getElementById('createPlayerName').value.trim() || document.getElementById('joinPlayerName').value.trim();
        socket.emit('submitWords', { roomId: currentRoomId, playerName, words });
    }

    socket.on('roomCreated', ({ roomId, players }) => {
        currentRoomId = roomId;
        document.getElementById('roomId').textContent = roomId;
        document.getElementById('players').textContent = players.join(', ');
        showSection('waitingSection');
    });

    socket.on('roomJoined', ({ roomId, players }) => {
        currentRoomId = roomId;
        document.getElementById('roomId').textContent = roomId;
        document.getElementById('players').textContent = players.join(', ');
        showSection('waitingSection');
    });

    socket.on('startWordInput', () => {
        showSection('wordInputSection');
    });

    socket.on('wordsCommitted', ({ committedPlayers, totalPlayers }) => {
        const list = document.getElementById('committedPlayersList');
        list.textContent = `${committedPlayers.length}/${totalPlayers} Spieler: ${committedPlayers.join(', ')}`;
    });

    socket.on('countdown', (seconds) => {
        document.getElementById('countdownDisplay').textContent = seconds >= 0 ? `Spiel startet in ${seconds}...` : '';
    });

    socket.on('gameStart', ({ role, word, players }) => {
        document.getElementById('role').textContent = role;
        document.getElementById('word').textContent = role === 'Spion' ? '' : `Dein Wort: ${word}`;
        document.getElementById('gamePlayers').textContent = players.join(', ');
        showSection('gameSection');
    });

    socket.on('error', ({ message }) => alert(message));
</script>
</body>
</html>
