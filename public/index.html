<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spion Spiel</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    .section { display: none; }
    .active { display: block; }
    input, button, select { margin: 10px; padding: 5px; }
  </style>
</head>
<body>
  <div id="startSection" class="section active">
    <h1>Spion Spiel</h1>
    <div>
      <h2>Raum erstellen</h2>
      <input type="text" id="createPlayerName" placeholder="Dein Name">
      <select id="roomSize">
        <option value="3">3 Spieler</option>
        <option value="4">4 Spieler</option>
        <option value="5">5 Spieler</option>
        <option value="6">6 Spieler</option>
      </select>
      <select id="spyCount">
        <option value="1">1 Spion</option>
        <option value="2">2 Spione</option>
        <option value="3">3 Spione</option>
      </select>
      <button onclick="createRoom()">Raum erstellen</button>
    </div>
    <div>
      <h2>Raum beitreten</h2>
      <input type="text" id="joinPlayerName" placeholder="Dein Name">
      <input type="text" id="roomIdInput" placeholder="Raum-ID">
      <button onclick="joinRoom()">Raum beitreten</button>
    </div>
  </div>

  <div id="waitingSection" class="section">
    <h2>Warte auf Spieler...</h2>
    <p>Raum-ID: <span id="roomId"></span></p>
    <p>Spieler: <span id="players"></span></p>
    <button onclick="leaveRoom()">Raum verlassen</button>
  </div>

  <div id="wordInputSection" class="section">
    <h2>Gib 5 Begriffe ein</h2>
    <input type="text" id="word1" placeholder="Begriff 1">
    <input type="text" id="word2" placeholder="Begriff 2">
    <input type="text" id="word3" placeholder="Begriff 3">
    <input type="text" id="word4" placeholder="Begriff 4">
    <input type="text" id="word5" placeholder="Begriff 5">
    <button onclick="submitWords()">Begriffe senden</button>
  </div>

  <div id="gameSection" class="section">
    <h1>Spion Spiel</h1>
    <p>Deine Rolle: <span id="role"></span></p>
    <p id="word"></p>
    <p>Spieler: <span id="gamePlayers"></span></p>
  </div>

  <script>
    const socket = io();
    let currentRoomId = null;

    function showSection(sectionId) {
      document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
      document.getElementById(sectionId).classList.add('active');
    }

    function createRoom() {
      const playerName = document.getElementById('createPlayerName').value.trim();
      const roomSize = parseInt(document.getElementById('roomSize').value);
      const spyCount = parseInt(document.getElementById('spyCount').value);
      if (!playerName) return alert('Bitte gib einen Namen ein.');
      if (spyCount >= roomSize) return alert('Die Anzahl der Spione muss kleiner als die Raumgröße sein.');
      socket.emit('createRoom', { playerName, roomSize, spyCount });
    }

    function joinRoom() {
      const playerName = document.getElementById('joinPlayerName').value.trim();
      const roomId = document.getElementById('roomIdInput').value.trim();
      if (!playerName || !roomId) return alert('Bitte gib Namen und Raum-ID ein.');
      socket.emit('joinRoom', { playerName, roomId });
    }

    function leaveRoom() {
      socket.emit('leaveRoom', { roomId: currentRoomId });
      currentRoomId = null;
      showSection('startSection');
    }

    function submitWords() {
      const words = [
        document.getElementById('word1').value.trim(),
        document.getElementById('word2').value.trim(),
        document.getElementById('word3').value.trim(),
        document.getElementById('word4').value.trim(),
        document.getElementById('word5').value.trim()
      ];
      if (words.some(word => !word)) return alert('Bitte gib alle 5 Begriffe ein.');
      socket.emit('submitWords', { roomId: currentRoomId, playerName: document.getElementById('createPlayerName').value.trim() || document.getElementById('joinPlayerName').value.trim(), words });
    }

    socket.on('roomCreated', ({ roomId, roomSize, spyCount, players }) => {
      currentRoomId = roomId;
      document.getElementById('roomId').textContent = roomId;
      document.getElementById('players').textContent = players.join(', ');
      showSection('waitingSection');
    });

    socket.on('roomJoined', ({ roomId, roomSize, players }) => {
      currentRoomId = roomId;
      document.getElementById('roomId').textContent = roomId;
      document.getElementById('players').textContent = players.join(', ');
      showSection('waitingSection');
    });

    socket.on('startWordInput', () => {
      showSection('wordInputSection');
    });

    socket.on('gameStart', ({ role, word, players }) => {
      document.getElementById('role').textContent = role;
      document.getElementById('word').textContent = role === 'Spion' ? '' : `Dein Wort: ${word}`;
      document.getElementById('gamePlayers').textContent = players.join(', ');
      showSection('gameSection');
    });

    socket.on('error', ({ message }) => {
      alert(message);
    });
  </script>
</body>
</html>
